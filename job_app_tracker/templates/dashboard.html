{% extends "base.html" %} {% block title %}Dashboard - Applizz{% endblock %} {%
block head %} {{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* Animation styles */
  .max-h-0 {
    max-height: 0 !important;
  }

  .opacity-0 {
    opacity: 0;
  }

  .transition-all {
    transition-property: all;
  }

  .duration-500 {
    transition-duration: 500ms;
  }

  .ease-in-out {
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Status colors with better contrast */
  .status-Applied {
    background-color: #4f46e5;
    color: white;
  }
  .status-Interview {
    background-color: #059669;
    color: white;
  }
  .status-Offer {
    background-color: #047857;
    color: white;
  }
  .status-Rejected {
    background-color: #dc2626;
    color: white;
  }
  .status-Withdrawn {
    background-color: #6b7280;
    color: white;
  }
  .status-In-Progress {
    background-color: #2563eb;
    color: white;
  }

  /* Card hover effects */
  .application-card {
    transition: all 0.3s ease;
    border: 1px solid #e5e7eb;
  }

  .application-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  /* Improved text contrast */
  .text-dark {
    color: #111827;
  }
  .text-medium {
    color: #374151;
  }
  .text-light {
    color: #6b7280;
  }

  /* Background colors */
  .bg-card {
    background-color: white;
  }
  .bg-highlight {
    background-color: #f3f4f6;
  }
  .bg-accent {
    background-color: #eef2ff;
  }
</style>
{% endblock %} {% block content %}
<div class="page-enter">
  <!-- Page Header -->
  <div class="md:flex md:items-center md:justify-between mb-8">
    <div class="flex-1 min-w-0">
      <h2
        class="text-2xl font-bold leading-7 text-dark sm:text-3xl sm:truncate"
      >
        Dashboard
      </h2>
    </div>
    <div class="mt-4 flex md:mt-0 md:ml-4">
      <button
        type="button"
        class="ml-3 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        onclick="window.location.href='{{ url_for('main.add_application') }}'"
      >
        <i class="fas fa-plus -ml-1 mr-2"></i>
        Add Application
      </button>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
    <!-- Total Applications -->
    <div class="bg-card overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-briefcase text-blue-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-medium truncate">
                Total Applications
              </dt>
              <dd class="flex items-baseline">
                <div class="text-2xl font-semibold text-dark">
                  {{ total_applications }}
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- In Progress -->
    <div class="bg-card overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-hourglass-half text-yellow-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-medium truncate">
                In Progress
              </dt>
              <dd class="flex items-baseline">
                <div class="text-2xl font-semibold text-dark">
                  {{ active_applications }}
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Interviews -->
    <div class="bg-card overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-user-tie text-green-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-medium truncate">
                Interviews
              </dt>
              <dd class="flex items-baseline">
                <div class="text-2xl font-semibold text-dark">
                  {{ status_counts.Interview }}
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Offers -->
    <div class="bg-card overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-check-circle text-green-600 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-medium truncate">Offers</dt>
              <dd class="flex items-baseline">
                <div class="text-2xl font-semibold text-dark">
                  {{ status_counts.Offer }}
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reminders Section -->
  {% if upcoming_deadlines or upcoming_interviews %}
  <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
    <div class="px-4 py-5 sm:px-6 bg-blue-50">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        <i class="fas fa-bell text-blue-500 mr-2"></i> Upcoming Reminders
      </h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">
        Your upcoming deadlines and interviews
      </p>
    </div>
    <div class="border-t border-gray-200">
      <dl>
        {% if upcoming_deadlines %}
        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">
            <i class="fas fa-calendar-day text-red-500 mr-2"></i> Upcoming
            Deadlines
          </dt>
          <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
            <ul class="divide-y divide-gray-200">
              {% for app in upcoming_deadlines %}
              <li class="py-3">
                <div class="flex justify-between">
                  <div>
                    <span class="font-medium">{{ app.company }}</span> - {{
                    app.position }}
                    <div class="text-sm text-gray-500">
                      Deadline:
                      <span class="font-semibold text-red-600"
                        >{{ app.deadline.strftime('%Y-%m-%d') }}</span
                      >
                    </div>
                  </div>
                  <a
                    href="{{ url_for('main.edit_application', application_id=app._id) }}"
                    class="text-blue-600 hover:text-blue-900"
                  >
                    <i class="fas fa-edit"></i> Edit
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          </dd>
        </div>
        {% endif %}
      </dl>
    </div>
  </div>
  {% endif %}

  <!-- Interview Section -->
  {% if status_counts.Interview > 0 %}
  <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
    <div class="px-4 py-5 sm:px-6 bg-green-50">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        <i class="fas fa-user-tie text-green-500 mr-2"></i> Interview Applications
      </h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">
        Your applications in the interview stage
      </p>
    </div>
    <div class="border-t border-gray-200">
      <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">
          <i class="fas fa-user-tie text-green-500 mr-2"></i> Interview
          Applications
        </dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
          <ul class="divide-y divide-gray-200">
            {% for app in applications if app.status == 'Interview' %}
            <li class="py-3">
              <div class="flex justify-between">
                <div>
                  <span class="font-medium">{{ app.company }}</span> - {{
                  app.position }}
                  <div class="text-sm text-gray-500">
                    Status:
                    <span
                      class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                    >
                      Interview
                    </span>
                  </div>
                </div>
                <a
                  href="{{ url_for('main.application_interviews', application_id=app._id) }}"
                  class="text-blue-600 hover:text-blue-900"
                >
                  <i class="fas fa-calendar-alt"></i> View Interviews
                </a>
              </div>
            </li>
            {% endfor %}
          </ul>
        </dd>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Data Visualization Section -->
  <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        <i class="fas fa-chart-pie text-blue-500 mr-2"></i> Application Analytics
      </h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">
        Visual breakdown of your job application progress
      </p>
    </div>
    <div class="border-t border-gray-200">
      <!-- Metrics Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4">
        <!-- Success Rate -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h4 class="text-sm font-medium text-gray-700 mb-2">Success Rate</h4>
          <div class="flex items-center">
            <div class="text-2xl font-bold text-green-600">{{ "%.1f"|format(success_rate.percentage) }}%</div>
            <div class="ml-4 text-sm text-gray-500">
              {{ success_rate.successful }} successful out of {{ success_rate.total }}
            </div>
          </div>
        </div>

        <!-- Applications per Week -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h4 class="text-sm font-medium text-gray-700 mb-2">Application Velocity</h4>
          <div class="flex items-center">
            <div class="text-2xl font-bold text-blue-600">{{ velocity_metrics.apps_per_week }}</div>
            <div class="ml-4 text-sm text-gray-500">
              applications per week
            </div>
          </div>
        </div>

        <!-- Average Time Between Applications -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h4 class="text-sm font-medium text-gray-700 mb-2">Average Time Between Applications</h4>
          <div class="flex items-center">
            <div class="text-2xl font-bold text-purple-600">{{ velocity_metrics.avg_time_between }}</div>
            <div class="ml-4 text-sm text-gray-500">
              days
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
        <!-- Status Distribution Chart -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h4 class="text-sm font-medium text-gray-700 mb-4">
            Application Status Distribution
          </h4>
          <div class="h-64 chart-container">
            <canvas id="statusChart"></canvas>
          </div>
        </div>

        <!-- Applications Over Time Chart -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-sm font-medium text-gray-700">
              Applications Over Time
            </h4>
            <!-- Time Range Filter -->
            <div class="flex space-x-2 mb-4">
                <button onclick="updateTimeRange('7')" class="time-range-btn px-3 py-1 text-sm font-medium rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-days="7">
                    Last 7 Days
                </button>
                <button onclick="updateTimeRange('28')" class="time-range-btn px-3 py-1 text-sm font-medium rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-days="28">
                    Last 28 Days
                </button>
                <button onclick="updateTimeRange('90')" class="time-range-btn px-3 py-1 text-sm font-medium rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-days="90">
                    Last 90 Days
                </button>
                <button onclick="updateTimeRange('365')" class="time-range-btn px-3 py-1 text-sm font-medium rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-days="365">
                    Last Year
                </button>
            </div>
          </div>
          <div class="h-64 chart-container">
            <canvas id="timelineChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter and Sort Controls -->
  <div class="bg-white p-4 shadow rounded-lg mb-6">
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0"
    >
      <div
        class="flex flex-col sm:flex-row sm:space-x-4 space-y-2 sm:space-y-0"
      >
        <!-- Status Filter -->
        <div>
          <label
            for="status-filter"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Status</label
          >
          <select
            id="status-filter"
            class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
          >
            <option value="all">All Statuses</option>
            <option value="Wishlist">Wishlist</option>
            <option value="Applied">Applied</option>
            <option value="In Progress">In Progress</option>
            <option value="Interview">Interview</option>
            <option value="Offer">Offer</option>
            <option value="Rejected">Rejected</option>
            <option value="Withdrawn">Withdrawn</option>
          </select>
        </div>

        <!-- Date Range Filter -->
        <div>
          <label
            for="date-filter"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Date Range</label
          >
          <select
            id="date-filter"
            class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
          >
            <option value="all">All Time</option>
            <option value="week">Last Week</option>
            <option value="month">Last Month</option>
            <option value="3months">Last 3 Months</option>
          </select>
        </div>
      </div>

      <!-- Sort Options -->
      <div>
        <label
          for="sort-by"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Sort By</label
        >
        <select
          id="sort-by"
          class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
        >
          <option value="date-desc">Date (Newest First)</option>
          <option value="date-asc">Date (Oldest First)</option>
          <option value="company">Company Name</option>
          <option value="status">Status</option>
        </select>
      </div>

      <!-- Search -->
      <div class="w-full md:w-64">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-1"
          >Search</label
        >
        <div class="relative rounded-md shadow-sm">
          <input
            type="text"
            id="search"
            class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-3 pr-10 py-2 sm:text-sm border-gray-300 rounded-md"
            placeholder="Search applications..."
          />
          <div
            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-search text-gray-400"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete All Applications Button -->
  <div class="mb-6 flex justify-end">
    <button
      type="button"
      id="delete-all-btn"
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
    >
      <i class="fas fa-trash-alt mr-2"></i>
      Delete All Applications
    </button>
  </div>

  <!-- Delete All Applications Modal -->
  <div
    id="delete-all-modal"
    class="fixed z-10 inset-0 overflow-y-auto hidden"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <div
      class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
    >
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        aria-hidden="true"
      ></div>

      <span
        class="hidden sm:inline-block sm:align-middle sm:h-screen"
        aria-hidden="true"
        >&#8203;</span
      >

      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div
              class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
            >
              <i class="fas fa-exclamation-triangle text-red-600"></i>
            </div>
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
              <h3
                class="text-lg leading-6 font-medium text-gray-900"
                id="modal-title"
              >
                Delete All Applications
              </h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500">
                  Are you sure you want to delete all your applications? This action cannot be undone.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <form id="delete-all-form" action="{{ url_for('main.delete_all_applications') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Delete All
            </button>
          </form>
          <button
            type="button"
            id="cancel-delete-all"
            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Applications Section -->
  <div class="mt-8">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center">
        <span>Your Applications</span>
        <button
          id="toggleApplications"
          class="ml-2 text-sm text-blue-600 hover:text-blue-800 focus:outline-none"
        >
          <span id="toggleText">Hide</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 inline transition-transform duration-300 ease-in-out"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </button>
      </h2>
      <a
        href="{{ url_for('main.add_application') }}"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"
      >
        Add New
      </a>
    </div>

    <div
      id="applicationsContainer"
      class="transition-all duration-500 ease-in-out overflow-hidden max-h-[2000px]"
    >
      <!-- Applications List -->
      <div class="flex flex-col">
        <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
          <div
            class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"
          >
            <div
              class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"
            >
              <table
                class="min-w-full divide-y divide-gray-200"
                id="applications-table"
              >
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                      data-sort="company"
                    >
                      Company
                      <i class="fas fa-sort ml-1"></i>
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                      data-sort="position"
                    >
                      Position
                      <i class="fas fa-sort ml-1"></i>
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                      data-sort="status"
                    >
                      Status
                      <i class="fas fa-sort ml-1"></i>
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                      data-sort="date"
                    >
                      Date Applied
                      <i class="fas fa-sort ml-1"></i>
                    </th>
                    <th scope="col" class="relative px-6 py-3">
                      <span class="sr-only">Actions</span>
                    </th>
                  </tr>
                </thead>
                <tbody
                  class="bg-white divide-y divide-gray-200"
                  id="applications-tbody"
                >
                  {% for application in applications %}
                  <tr class="application-row hover:bg-gray-50" data-page="1">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        {% if application.company_logo %}
                        <div class="flex-shrink-0 h-10 w-10">
                          <img
                            class="h-10 w-10 rounded-full"
                            src="{{ application.company_logo }}"
                            alt="{{ application.company }}"
                          />
                        </div>
                        {% else %}
                        <div
                          class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"
                        >
                          <span class="text-gray-500 font-medium"
                            >{{ application.company[:2].upper() }}</span
                          >
                        </div>
                        {% endif %}
                        <div class="ml-4">
                          <div class="text-sm font-medium text-gray-900">
                            {{ application.company }}
                          </div>
                          <div class="text-sm text-gray-500">
                            {{ application.location }}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-900">
                        {{ application.position }}
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if application.status == 'Applied' %}bg-gray-100 text-gray-800{% elif application.status == 'In Progress' %}bg-yellow-100 text-yellow-800{% elif application.status == 'Interview' %}bg-blue-100 text-blue-800{% elif application.status == 'Offer' %}bg-green-100 text-green-800{% elif application.status == 'Rejected' %}bg-red-100 text-red-800{% elif application.status == 'Wishlist' %}bg-purple-100 text-purple-800{% elif application.status == 'Withdrawn' %}bg-gray-100 text-gray-800{% endif %}"
                      >
                        {{ application.status }}
                      </span>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                    >
                      {{ application.date_applied.strftime('%Y-%m-%d') if
                      application.date_applied else 'N/A' }}
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                    >
                      <div class="flex flex-col space-y-2 items-end">
                        <div>
                          <a
                            href="{{ url_for('main.edit_application', application_id=application._id) }}"
                            class="text-blue-600 hover:text-blue-900 mr-3"
                          >
                            <i class="fas fa-edit"></i> Edit
                          </a>
                          <a
                            href="#"
                            class="text-red-600 hover:text-red-900 delete-app"
                            data-id="{{ application._id }}"
                            data-company="{{ application.company }}"
                          >
                            <i class="fas fa-trash"></i> Delete
                          </a>
                        </div>
                        <div class="flex space-x-2">
                          <a
                            href="{{ url_for('main.application_notes', application_id=application._id) }}"
                            class="text-gray-600 hover:text-gray-900 text-xs"
                            title="Notes"
                          >
                            <i class="fas fa-sticky-note"></i>
                          </a>
                          <a
                            href="{{ url_for('main.application_documents', application_id=application._id) }}"
                            class="text-gray-600 hover:text-gray-900 text-xs"
                            title="Documents"
                          >
                            <i class="fas fa-file"></i>
                          </a>
                          <a
                            href="{{ url_for('main.application_interviews', application_id=application._id) }}"
                            class="text-gray-600 hover:text-gray-900 text-xs"
                            title="Interviews"
                          >
                            <i class="fas fa-calendar-alt"></i>
                          </a>
                        </div>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination Controls -->
      <div class="mt-4 flex justify-between items-center">
        <div class="text-sm text-gray-700">
          Showing <span id="showing-start">1</span> to
          <span id="showing-end">3</span> of
          <span id="total-items">{{ applications|length }}</span> applications
        </div>
        <div class="flex space-x-2">
          <button
            id="prev-page"
            class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fas fa-chevron-left mr-1"></i> Previous
          </button>
          <div id="page-numbers" class="flex space-x-1">
            <!-- Page numbers will be inserted here by JavaScript -->
          </div>
          <button
            id="next-page"
            class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Next <i class="fas fa-chevron-right ml-1"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  {% if not applications %}
  <div class="text-center py-12">
    <i class="fas fa-inbox text-gray-400 text-5xl mb-4"></i>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No applications yet</h3>
    <p class="text-gray-500">Start by adding your first job application.</p>
  </div>
  {% endif %}

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
    <div
      class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
    >
      <div class="fixed inset-0 transition-opacity" aria-hidden="true">
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
      </div>
      <span
        class="hidden sm:inline-block sm:align-middle sm:h-screen"
        aria-hidden="true"
        >&#8203;</span
      >
      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div
              class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
            >
              <i class="fas fa-exclamation-triangle text-red-600"></i>
            </div>
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
              <h3
                class="text-lg leading-6 font-medium text-gray-900"
                id="modal-title"
              >
                Delete Application
              </h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500" id="modal-description">
                  Are you sure you want to delete this application? This action
                  cannot be undone.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <form id="delete-form" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input
              type="hidden"
              id="delete-id"
              name="application_id"
              value=""
            />
            <button
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Delete
            </button>
          </form>
          <button
            type="button"
            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            id="cancel-delete"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Toggle user menu
    const userMenuButton = document.getElementById("user-menu-button");
    const userMenu = document.getElementById("user-menu");

    if (userMenuButton && userMenu) {
      userMenuButton.addEventListener("click", function () {
        userMenu.classList.toggle("hidden");
      });
    }

    // Pagination variables
    const itemsPerPage = 3;
    let currentPage = 1;
    const applicationRows = document.querySelectorAll(".application-row");
    const totalItems = applicationRows.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);

    // Pagination elements
    const prevPageBtn = document.getElementById("prev-page");
    const nextPageBtn = document.getElementById("next-page");
    const pageNumbers = document.getElementById("page-numbers");
    const showingStart = document.getElementById("showing-start");
    const showingEnd = document.getElementById("showing-end");
    const totalItemsSpan = document.getElementById("total-items");

    // Toggle applications section
    const toggleBtn = document.getElementById("toggleApplications");
    const toggleText = document.getElementById("toggleText");
    const applicationsContainer = document.getElementById("applicationsContainer");

    if (toggleBtn && applicationsContainer) {
      toggleBtn.addEventListener("click", function () {
        const isVisible = !applicationsContainer.classList.contains("max-h-0");

        if (isVisible) {
          // Hide the container
          applicationsContainer.style.maxHeight = applicationsContainer.scrollHeight + "px";
          // Force a reflow
          applicationsContainer.offsetHeight;
          applicationsContainer.classList.add("max-h-0");
          applicationsContainer.classList.add("opacity-0");
          toggleText.textContent = "Show";
          toggleBtn.querySelector("svg").style.transform = "rotate(180deg)";
        } else {
          // Show the container
          applicationsContainer.classList.remove("max-h-0");
          applicationsContainer.classList.remove("opacity-0");
          applicationsContainer.style.maxHeight = "2000px"; // Set to a large value
          toggleText.textContent = "Hide";
          toggleBtn.querySelector("svg").style.transform = "rotate(0deg)";
        }
      });
    }

    // Initialize pagination
    function initPagination() {
      if (totalItems === 0) return;

      // Create page number buttons
      pageNumbers.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.textContent = i;
        pageBtn.classList.add("px-3", "py-1", "border", "border-gray-300", "rounded-md", "text-sm", "font-medium");
        pageBtn.classList.add(i === currentPage ? "bg-blue-50" : "bg-white");
        pageBtn.classList.add(i === currentPage ? "text-blue-600" : "text-gray-700");
        pageBtn.classList.add("hover:bg-gray-50");
        pageBtn.addEventListener("click", () => goToPage(i));
        pageNumbers.appendChild(pageBtn);
      }

      // Update buttons state
      updatePaginationControls();

      // Show first page
      showPage(currentPage);
    }

    // Go to specific page
    function goToPage(page) {
      currentPage = page;
      showPage(currentPage);
      updatePaginationControls();
    }

    // Show specific page
    function showPage(page) {
      const start = (page - 1) * itemsPerPage;
      const end = Math.min(start + itemsPerPage, totalItems);

      // Hide all rows
      applicationRows.forEach(row => {
        row.classList.add("hidden");
      });

      // Show rows for current page
      for (let i = start; i < end; i++) {
        if (applicationRows[i]) {
          applicationRows[i].classList.remove("hidden");
        }
      }

      // Update showing text
      showingStart.textContent = totalItems === 0 ? 0 : start + 1;
      showingEnd.textContent = end;
      totalItemsSpan.textContent = totalItems;
    }

    // Update pagination controls
    function updatePaginationControls() {
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;

      // Update active page button
      const pageButtons = pageNumbers.querySelectorAll("button");
      pageButtons.forEach((btn, index) => {
        btn.classList.toggle("bg-blue-50", index + 1 === currentPage);
        btn.classList.toggle("text-blue-600", index + 1 === currentPage);
        btn.classList.toggle("bg-white", index + 1 !== currentPage);
        btn.classList.toggle("text-gray-700", index + 1 !== currentPage);
      });
    }

    // Add event listeners for pagination buttons
    if (prevPageBtn) {
      prevPageBtn.addEventListener("click", function() {
        if (currentPage > 1) {
          goToPage(currentPage - 1);
        }
      });
    }

    if (nextPageBtn) {
      nextPageBtn.addEventListener("click", function() {
        if (currentPage < totalPages) {
          goToPage(currentPage + 1);
        }
      });
    }

    // Initialize pagination
    initPagination();

    // Filter and sort functionality
    const statusFilter = document.getElementById("status-filter");
    const dateFilter = document.getElementById("date-filter");
    const sortBy = document.getElementById("sort-by");
    const searchInput = document.getElementById("search");

    function applyFilters() {
      const statusValue = statusFilter.value;
      const searchValue = searchInput.value.toLowerCase();

      // Reset visibility for all rows
      let visibleRows = [];
      applicationRows.forEach((row) => {
        const company = row
          .querySelector("td:nth-child(1)")
          .textContent.toLowerCase();
        const position = row
          .querySelector("td:nth-child(2)")
          .textContent.toLowerCase();
        const status = row.querySelector("td:nth-child(3)").textContent.trim();

        const statusMatch = statusValue === "all" || status === statusValue;
        const searchMatch =
          company.includes(searchValue) || position.includes(searchValue);

        if (statusMatch && searchMatch) {
          row.classList.remove("filtered-out");
          visibleRows.push(row);
        } else {
          row.classList.add("filtered-out");
          row.classList.add("hidden");
        }
      });

      // Update pagination variables based on filtered rows
      const filteredTotalItems = visibleRows.length;
      const filteredTotalPages = Math.ceil(filteredTotalItems / itemsPerPage);

      // Reset to page 1 when filters change
      currentPage = 1;

      // Update pagination display
      totalItemsSpan.textContent = filteredTotalItems;

      // Recreate page number buttons
      pageNumbers.innerHTML = "";
      for (let i = 1; i <= filteredTotalPages; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.textContent = i;
        pageBtn.classList.add("px-3", "py-1", "border", "border-gray-300", "rounded-md", "text-sm", "font-medium");
        pageBtn.classList.add(i === currentPage ? "bg-blue-50" : "bg-white");
        pageBtn.classList.add(i === currentPage ? "text-blue-600" : "text-gray-700");
        pageBtn.classList.add("hover:bg-gray-50");
        pageBtn.addEventListener("click", () => {
          currentPage = i;
          showFilteredPage(i, visibleRows);
          updatePaginationControls(i, filteredTotalPages);
        });
        pageNumbers.appendChild(pageBtn);
      }

      // Show first page of filtered results
      showFilteredPage(1, visibleRows);
      updatePaginationControls(1, filteredTotalPages);

      // Update pagination buttons
      prevPageBtn.disabled = true; // On first page after filtering
      nextPageBtn.disabled = filteredTotalPages <= 1;

      // Update event listeners for pagination buttons
      prevPageBtn.onclick = function() {
        if (currentPage > 1) {
          currentPage--;
          showFilteredPage(currentPage, visibleRows);
          updatePaginationControls(currentPage, filteredTotalPages);
        }
      };

      nextPageBtn.onclick = function() {
        if (currentPage < filteredTotalPages) {
          currentPage++;
          showFilteredPage(currentPage, visibleRows);
          updatePaginationControls(currentPage, filteredTotalPages);
        }
      };
    }

    // Show specific page of filtered results
    function showFilteredPage(page, visibleRows) {
      const start = (page - 1) * itemsPerPage;
      const end = Math.min(start + itemsPerPage, visibleRows.length);

      // Hide all rows first
      applicationRows.forEach(row => {
        row.classList.add("hidden");
      });

      // Show only the rows for current page
      for (let i = start; i < end; i++) {
        if (visibleRows[i]) {
          visibleRows[i].classList.remove("hidden");
        }
      }

      // Update showing text
      showingStart.textContent = visibleRows.length === 0 ? 0 : start + 1;
      showingEnd.textContent = end;
    }

    // Update pagination controls for filtered results
    function updatePaginationControls(page, totalPages) {
      prevPageBtn.disabled = page === 1;
      nextPageBtn.disabled = page === totalPages || totalPages === 0;

      // Update active page button
      const pageButtons = pageNumbers.querySelectorAll("button");
      pageButtons.forEach((btn, index) => {
        btn.classList.toggle("bg-blue-50", index + 1 === page);
        btn.classList.toggle("text-blue-600", index + 1 === page);
        btn.classList.toggle("bg-white", index + 1 !== page);
        btn.classList.toggle("text-gray-700", index + 1 !== page);
      });
    }

    // Add event listeners for filters
    if (statusFilter) statusFilter.addEventListener("change", applyFilters);
    if (searchInput) searchInput.addEventListener("input", applyFilters);

    // Delete application functionality
    const deleteButtons = document.querySelectorAll(".delete-app");
    const deleteModal = document.getElementById("delete-modal");
    const deleteForm = document.getElementById("delete-form");
    const deleteId = document.getElementById("delete-id");
    const modalDescription = document.getElementById("modal-description");
    const cancelDelete = document.getElementById("cancel-delete");

    deleteButtons.forEach((button) => {
      button.addEventListener("click", function (e) {
        e.preventDefault();
        const appId = this.getAttribute("data-id");
        const company = this.getAttribute("data-company");

        document.getElementById('modal-description').textContent =
          `Are you sure you want to delete the "${company}" application? This action cannot be undone.`;

        document.getElementById('delete-id').value = appId;
        document.getElementById('delete-form').action = `/application/delete/${appId}`;

        document.getElementById('delete-modal').classList.remove('hidden');
      });
    });

    if (cancelDelete) {
      cancelDelete.addEventListener("click", function () {
        deleteModal.classList.add("hidden");
      });
    }

    // Close modal when clicking outside
    deleteModal.addEventListener("click", function (e) {
      if (e.target === deleteModal) {
        deleteModal.classList.add("hidden");
      }
    });

    // Delete all applications functionality
    const deleteAllBtn = document.getElementById('delete-all-btn');
    const deleteAllModal = document.getElementById('delete-all-modal');
    const cancelDeleteAll = document.getElementById('cancel-delete-all');

    if (deleteAllBtn) {
      deleteAllBtn.addEventListener('click', function() {
        deleteAllModal.classList.remove('hidden');
      });
    }

    if (cancelDeleteAll) {
      cancelDeleteAll.addEventListener('click', function() {
        deleteAllModal.classList.add('hidden');
      });
    }

    // Close modal when clicking outside
    deleteAllModal.addEventListener('click', function(e) {
      if (e.target === deleteAllModal) {
        deleteAllModal.classList.add('hidden');
      }
    });

    // Initialize Charts
    try {
      if (document.getElementById('statusChart')) {
        // Status Distribution Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
          type: 'doughnut',
          data: {
            labels: ['Applied', 'In Progress', 'Interview', 'Offer', 'Rejected'],
            datasets: [{
              data: [
                {{ status_counts.Applied if status_counts.Applied else 0 }},
                {{ status_counts['In Progress'] if status_counts['In Progress'] else 0 }},
                {{ status_counts.Interview if status_counts.Interview else 0 }},
                {{ status_counts.Offer if status_counts.Offer else 0 }},
                {{ status_counts.Rejected if status_counts.Rejected else 0 }}
              ],
              backgroundColor: [
                '#9CA3AF', // gray-400
                '#FBBF24', // yellow-400
                '#60A5FA', // blue-400
                '#34D399', // green-400
                '#F87171'  // red-400
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
              }
            }
          }
        });

        // Timeline Chart
        const timelineCtx = document.getElementById('timelineChart').getContext('2d');
        const timelineChart = new Chart(timelineCtx, {
          type: 'line',
          data: {
            labels: {{ timeline_data|map(attribute='date')|list|tojson }},
            datasets: [
              {
                label: 'Applied',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Applied')|list|tojson }},
                borderColor: '#4CAF50',
                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Interview',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Interview')|list|tojson }},
                borderColor: '#2196F3',
                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Offer',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Offer')|list|tojson }},
                borderColor: '#FFC107',
                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Rejected',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Rejected')|list|tojson }},
                borderColor: '#F44336',
                backgroundColor: 'rgba(244, 67, 54, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'In Progress',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='In Progress')|list|tojson }},
                borderColor: '#9C27B0',
                backgroundColor: 'rgba(156, 39, 176, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Wishlist',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Wishlist')|list|tojson }},
                borderColor: '#795548',
                backgroundColor: 'rgba(121, 85, 72, 0.1)',
                tension: 0.4,
                fill: true
              },
              {
                label: 'Withdrawn',
                data: {{ timeline_data|map(attribute='counts')|map(attribute='Withdrawn')|list|tojson }},
                borderColor: '#607D8B',
                backgroundColor: 'rgba(96, 125, 139, 0.1)',
                tension: 0.4,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed.y !== null) {
                      label += context.parsed.y + ' applications';
                    }
                    return label;
                  }
                }
              },
              legend: {
                position: 'top',
                labels: {
                  usePointStyle: true,
                  padding: 20,
                  font: {
                    size: 12
                  }
                }
              }
            },
            scales: {
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  maxRotation: 45,
                  minRotation: 45
                }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1
                }
              }
            }
          }
        });

        // Store the full timeline data
        const fullTimelineData = {{ timeline_data|tojson }};

        // Initialize time range buttons
        const timeRangeButtons = document.querySelectorAll('.time-range-btn');
        const currentTimeRange = new URLSearchParams(window.location.search).get('time_range') || '28';
        
        // Highlight the active time range button
        timeRangeButtons.forEach(button => {
            if (button.getAttribute('data-days') === currentTimeRange) {
                button.classList.remove('bg-gray-100');
                button.classList.add('bg-blue-100', 'text-blue-700');
            }
        });

        // Update time range function
        window.updateTimeRange = function(days) {
            // Update URL without page reload
            const url = new URL(window.location.href);
            url.searchParams.set('time_range', days);
            window.history.pushState({}, '', url);

            // Update button styles
            timeRangeButtons.forEach(button => {
                if (button.getAttribute('data-days') === days) {
                    button.classList.remove('bg-gray-100');
                    button.classList.add('bg-blue-100', 'text-blue-700');
                } else {
                    button.classList.remove('bg-blue-100', 'text-blue-700');
                    button.classList.add('bg-gray-100');
                }
            });

            // Filter the data based on the selected time range
            const daysToShow = parseInt(days);
            const now = new Date();
            const filteredData = fullTimelineData.filter(item => {
                const itemDate = new Date(item.date);
                const diffTime = Math.abs(now - itemDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= daysToShow;
            });

            // Sort the filtered data by date
            filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Update chart data
            timelineChart.data.labels = filteredData.map(item => item.date);
            timelineChart.data.datasets.forEach(dataset => {
                const status = dataset.label;
                dataset.data = filteredData.map(item => item.counts[status] || 0);
            });

            // Update the chart
            timelineChart.update();
        };

        // Apply initial time range filter
        updateTimeRange(currentTimeRange);

        console.log("Charts initialized successfully");
      } else {
        console.error("Chart elements not found in the DOM");
      }
    } catch (error) {
      console.error("Error initializing charts:", error);
    }
  });
</script>
{% endblock %}
